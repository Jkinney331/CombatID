// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// CORE MODELS - Phase 0
// ============================================================================

enum UserRole {
  SUPER_ADMIN
  COMMISSION_ADMIN
  PROMOTION_ADMIN
  GYM_ADMIN
  FIGHTER
  DOCTOR
  OFFICIAL
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_VERIFICATION
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  auth0Id   String   @unique @map("auth0_id")
  role      UserRole
  status    UserStatus @default(PENDING_VERIFICATION)

  // Personal Information
  firstName String?  @map("first_name")
  lastName  String?  @map("last_name")
  phone     String?
  avatarUrl String?  @map("avatar_url")

  // Auth0 metadata
  emailVerified Boolean @default(false) @map("email_verified")

  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  lastLoginAt DateTime? @map("last_login_at")

  // Relations
  organizationMemberships OrganizationMember[]
  consents                UserConsent[]
  invitationsSent         UserInvitation[] @relation("InvitedByUser")
  auditLogs               AuditLog[]
  sessions                UserSession[]

  // Phase 2+ Relations
  fighter                 Fighter?
  documentsReviewed       Document[]        @relation("DocumentReviewer")
  documentsShared         DocumentShare[]   @relation("DocumentSharer")
  suspensionsLifted       MedicalSuspension[] @relation("SuspensionLifter")
  eligibilityOverrides    EligibilityCheck[] @relation("EligibilityOverrider")

  @@index([email])
  @@index([auth0Id])
  @@map("users")
}

enum OrganizationType {
  COMMISSION
  PROMOTION
  GYM
}

enum OrganizationStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  PENDING_APPROVAL
}

model Organization {
  id          String             @id @default(uuid())
  name        String
  type        OrganizationType
  status      OrganizationStatus @default(PENDING_APPROVAL)

  // Contact Information
  email       String?
  phone       String?
  website     String?

  // Address
  address     String?
  city        String?
  state       String?
  country     String?
  postalCode  String?            @map("postal_code")

  // For Commissions: jurisdiction info
  jurisdiction String?           // State/region code

  // Timestamps
  createdAt   DateTime           @default(now()) @map("created_at")
  updatedAt   DateTime           @updatedAt @map("updated_at")

  // Relations
  members     OrganizationMember[]
  invitations UserInvitation[]

  // Phase 2+ Relations
  fighters           Fighter[]           @relation("GymFighters")
  sharedDocuments    DocumentShare[]     @relation("SharedDocuments")
  licensesIssued     FighterLicense[]    @relation("CommissionLicenses")
  suspensionsIssued  MedicalSuspension[] @relation("CommissionSuspensions")
  rulesets           Ruleset[]           @relation("CommissionRulesets")

  @@index([type, status])
  @@map("organizations")
}

enum MemberRole {
  OWNER
  ADMIN
  MEMBER
  VIEWER
}

model OrganizationMember {
  id             String       @id @default(uuid())
  userId         String       @map("user_id")
  organizationId String       @map("organization_id")
  role           MemberRole

  // Timestamps
  joinedAt       DateTime     @default(now()) @map("joined_at")

  // Relations
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([userId, organizationId])
  @@map("organization_members")
}

// ============================================================================
// PHASE 1: Identity & Access
// ============================================================================

// User consent tracking for HIPAA compliance
model UserConsent {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  version     String   // Consent version (e.g., "1.0", "2.0")
  type        ConsentType
  granted     Boolean
  grantedAt   DateTime @default(now()) @map("granted_at")
  revokedAt   DateTime? @map("revoked_at")
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @map("user_agent")

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, type, version])
  @@map("user_consents")
}

enum ConsentType {
  TERMS_OF_SERVICE
  PRIVACY_POLICY
  HIPAA_AUTHORIZATION
  DATA_SHARING
  MARKETING_COMMUNICATIONS
}

// User invitation system
model UserInvitation {
  id             String           @id @default(uuid())
  email          String
  role           UserRole
  organizationId String?          @map("organization_id")
  invitedById    String           @map("invited_by_id")
  token          String           @unique
  status         InvitationStatus @default(PENDING)
  expiresAt      DateTime         @map("expires_at")
  acceptedAt     DateTime?        @map("accepted_at")
  createdAt      DateTime         @default(now()) @map("created_at")

  organization   Organization?    @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  invitedBy      User             @relation("InvitedByUser", fields: [invitedById], references: [id])

  @@map("user_invitations")
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
  CANCELLED
}

// Audit log for compliance tracking
model AuditLog {
  id          String   @id @default(uuid())
  userId      String?  @map("user_id")
  action      String   // CREATE, UPDATE, DELETE, LOGIN, etc.
  entityType  String   @map("entity_type") // User, Organization, Fighter, etc.
  entityId    String?  @map("entity_id")
  oldValues   Json?    @map("old_values")
  newValues   Json?    @map("new_values")
  ipAddress   String?  @map("ip_address")
  userAgent   String?  @map("user_agent")
  createdAt   DateTime @default(now()) @map("created_at")

  user        User?    @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([entityType, entityId])
  @@index([createdAt])
  @@map("audit_logs")
}

// Session tracking for security
model UserSession {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  auth0SessionId String? @unique @map("auth0_session_id")
  ipAddress    String?  @map("ip_address")
  userAgent    String?  @map("user_agent")
  lastActiveAt DateTime @default(now()) @map("last_active_at")
  expiresAt    DateTime @map("expires_at")
  createdAt    DateTime @default(now()) @map("created_at")

  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_sessions")
}

// ============================================================================
// PHASE 2: Fighter Core
// ============================================================================

enum WeightClass {
  STRAWWEIGHT      // 115 lbs
  FLYWEIGHT        // 125 lbs
  BANTAMWEIGHT     // 135 lbs
  FEATHERWEIGHT    // 145 lbs
  LIGHTWEIGHT      // 155 lbs
  WELTERWEIGHT     // 170 lbs
  MIDDLEWEIGHT     // 185 lbs
  LIGHT_HEAVYWEIGHT // 205 lbs
  HEAVYWEIGHT      // 265 lbs
  SUPER_HEAVYWEIGHT // 265+ lbs
}

enum Discipline {
  MMA
  BOXING
  KICKBOXING
  MUAY_THAI
  WRESTLING
  BJJ
  JUDO
  KARATE
}

enum FighterStatus {
  ACTIVE
  INACTIVE
  RETIRED
  SUSPENDED
}

enum VerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum EligibilityStatus {
  ELIGIBLE
  CONDITIONAL
  INCOMPLETE
  EXPIRED
  UNDER_REVIEW
  SUSPENDED
}

model Fighter {
  id                String             @id @default(uuid())
  combatId          String             @unique @map("combat_id")
  userId            String             @unique @map("user_id")

  // Personal Info
  firstName         String             @map("first_name")
  lastName          String             @map("last_name")
  nickname          String?
  dateOfBirth       DateTime           @map("date_of_birth")
  gender            String?
  nationality       String?
  countryOfBirth    String?            @map("country_of_birth")

  // Contact/Address
  currentCity       String?            @map("current_city")
  currentState      String?            @map("current_state")
  currentCountry    String?            @map("current_country")

  // Physical Attributes
  heightCm          Int?               @map("height_cm")
  reachCm           Int?               @map("reach_cm")

  // Fighting Info
  weightClass       WeightClass?       @map("weight_class")
  disciplines       Discipline[]
  stance            String?            // Orthodox, Southpaw, Switch

  // Gym/Team
  gymId             String?            @map("gym_id")

  // Record
  wins              Int                @default(0)
  losses            Int                @default(0)
  draws             Int                @default(0)
  noContests        Int                @default(0) @map("no_contests")
  knockouts         Int                @default(0)
  submissions       Int                @default(0)

  // Status
  status            FighterStatus      @default(ACTIVE)
  verificationStatus VerificationStatus @default(PENDING) @map("verification_status")
  eligibilityStatus  EligibilityStatus  @default(INCOMPLETE) @map("eligibility_status")

  // Profile
  bio               String?
  photoUrl          String?            @map("photo_url")

  // Timestamps
  createdAt         DateTime           @default(now()) @map("created_at")
  updatedAt         DateTime           @updatedAt @map("updated_at")

  // Relations
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  gym               Organization?      @relation("GymFighters", fields: [gymId], references: [id])
  documents         Document[]
  licenses          FighterLicense[]
  suspensions       MedicalSuspension[]
  eligibilityChecks EligibilityCheck[]
  boutsFighterA     Bout[]             @relation("FighterA")
  boutsFighterB     Bout[]             @relation("FighterB")

  @@index([combatId])
  @@index([status, eligibilityStatus])
  @@index([weightClass])
  @@map("fighters")
}

// ============================================================================
// PHASE 2: Document Vault
// ============================================================================

enum DocumentType {
  // Medical
  PHYSICAL_EXAM
  BLOOD_TEST
  HIV_TEST
  HEPATITIS_B_TEST
  HEPATITIS_C_TEST
  EYE_EXAM
  MRI_BRAIN
  MRI_SPINE
  EKG
  ECHO
  NEUROLOGICAL_EXAM
  DRUG_TEST

  // Identification
  PHOTO_ID
  PASSPORT
  BIRTH_CERTIFICATE

  // Licensing
  FIGHTER_LICENSE
  TRAINER_LICENSE
  CORNER_LICENSE

  // Insurance
  HEALTH_INSURANCE
  FIGHTER_INSURANCE

  // Contracts
  BOUT_AGREEMENT
  PROMOTIONAL_CONTRACT

  // Other
  OTHER
}

enum DocumentStatus {
  PENDING_UPLOAD
  UPLOADED
  PROCESSING
  PENDING_REVIEW
  APPROVED
  REJECTED
  EXPIRED
}

model Document {
  id                String           @id @default(uuid())
  fighterId         String           @map("fighter_id")
  type              DocumentType

  // File Info
  fileName          String           @map("file_name")
  fileKey           String           @map("file_key") // S3 key
  fileSize          Int              @map("file_size")
  mimeType          String           @map("mime_type")
  checksum          String?          // MD5/SHA256 for integrity

  // Status
  status            DocumentStatus   @default(PENDING_UPLOAD)

  // AI Processing
  aiProcessed       Boolean          @default(false) @map("ai_processed")
  aiConfidence      Float?           @map("ai_confidence")
  extractedData     Json?            @map("extracted_data")
  classifiedType    DocumentType?    @map("classified_type")

  // Document Content
  issueDate         DateTime?        @map("issue_date")
  expirationDate    DateTime?        @map("expiration_date")
  issuingAuthority  String?          @map("issuing_authority")
  documentNumber    String?          @map("document_number")

  // Review
  reviewedById      String?          @map("reviewed_by_id")
  reviewedAt        DateTime?        @map("reviewed_at")
  reviewNotes       String?          @map("review_notes")
  rejectionReason   String?          @map("rejection_reason")

  // Versioning
  version           Int              @default(1)
  previousVersionId String?          @map("previous_version_id")
  isLatest          Boolean          @default(true) @map("is_latest")

  // Sharing
  sharedWith        DocumentShare[]

  // Timestamps
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")
  deletedAt         DateTime?        @map("deleted_at") // Soft delete

  // Relations
  fighter           Fighter          @relation(fields: [fighterId], references: [id], onDelete: Cascade)
  reviewedBy        User?            @relation("DocumentReviewer", fields: [reviewedById], references: [id])
  previousVersion   Document?        @relation("DocumentVersions", fields: [previousVersionId], references: [id])
  newerVersions     Document[]       @relation("DocumentVersions")

  @@index([fighterId, type])
  @@index([status])
  @@index([expirationDate])
  @@map("documents")
}

model DocumentShare {
  id                String           @id @default(uuid())
  documentId        String           @map("document_id")
  sharedWithOrgId   String           @map("shared_with_org_id")
  sharedById        String           @map("shared_by_id")

  // Permissions
  canView           Boolean          @default(true) @map("can_view")
  canDownload       Boolean          @default(false) @map("can_download")

  // Expiration
  expiresAt         DateTime?        @map("expires_at")

  // Timestamps
  createdAt         DateTime         @default(now()) @map("created_at")
  revokedAt         DateTime?        @map("revoked_at")

  // Relations
  document          Document         @relation(fields: [documentId], references: [id], onDelete: Cascade)
  sharedWithOrg     Organization     @relation("SharedDocuments", fields: [sharedWithOrgId], references: [id])
  sharedBy          User             @relation("DocumentSharer", fields: [sharedById], references: [id])

  @@unique([documentId, sharedWithOrgId])
  @@map("document_shares")
}

// ============================================================================
// PHASE 2: Fighter Licensing
// ============================================================================

enum LicenseType {
  PROFESSIONAL
  AMATEUR
  TRAINER
  CORNERMAN
  REFEREE
  JUDGE
}

enum LicenseStatus {
  ACTIVE
  EXPIRED
  SUSPENDED
  REVOKED
  PENDING
}

model FighterLicense {
  id                String           @id @default(uuid())
  fighterId         String           @map("fighter_id")
  commissionId      String           @map("commission_id")

  // License Details
  type              LicenseType
  licenseNumber     String           @map("license_number")
  disciplines       Discipline[]

  // Status
  status            LicenseStatus    @default(PENDING)

  // Dates
  issuedAt          DateTime?        @map("issued_at")
  expiresAt         DateTime?        @map("expires_at")

  // Timestamps
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  // Relations
  fighter           Fighter          @relation(fields: [fighterId], references: [id], onDelete: Cascade)
  commission        Organization     @relation("CommissionLicenses", fields: [commissionId], references: [id])

  @@unique([fighterId, commissionId, type])
  @@index([licenseNumber])
  @@index([expiresAt])
  @@map("fighter_licenses")
}

// ============================================================================
// PHASE 2: Medical Suspensions
// ============================================================================

enum SuspensionType {
  MEDICAL
  DISCIPLINARY
  ADMINISTRATIVE
}

enum SuspensionStatus {
  ACTIVE
  LIFTED
  EXPIRED
}

model MedicalSuspension {
  id                String           @id @default(uuid())
  fighterId         String           @map("fighter_id")
  commissionId      String           @map("commission_id")

  // Suspension Details
  type              SuspensionType   @default(MEDICAL)
  reason            String
  description       String?

  // Status
  status            SuspensionStatus @default(ACTIVE)

  // Dates
  startDate         DateTime         @map("start_date")
  endDate           DateTime?        @map("end_date") // null = indefinite
  minimumDays       Int?             @map("minimum_days")

  // Requirements to lift
  requiresClearance Boolean          @default(false) @map("requires_clearance")
  clearanceType     String?          @map("clearance_type") // e.g., "MRI", "Neurological"

  // Lifting info
  liftedAt          DateTime?        @map("lifted_at")
  liftedById        String?          @map("lifted_by_id")
  liftNotes         String?          @map("lift_notes")

  // Cross-commission sharing
  isNational        Boolean          @default(false) @map("is_national") // Shared across all commissions

  // Timestamps
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  // Relations
  fighter           Fighter          @relation(fields: [fighterId], references: [id], onDelete: Cascade)
  commission        Organization     @relation("CommissionSuspensions", fields: [commissionId], references: [id])
  liftedBy          User?            @relation("SuspensionLifter", fields: [liftedById], references: [id])

  @@index([fighterId, status])
  @@index([endDate])
  @@map("medical_suspensions")
}

// ============================================================================
// PHASE 4: Eligibility Engine
// ============================================================================

model Ruleset {
  id                String           @id @default(uuid())
  commissionId      String           @map("commission_id")
  discipline        Discipline
  name              String
  description       String?

  // Versioning
  version           Int              @default(1)
  isActive          Boolean          @default(true) @map("is_active")

  // Timestamps
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  // Relations
  commission        Organization     @relation("CommissionRulesets", fields: [commissionId], references: [id])
  requirements      RulesetRequirement[]
  eligibilityChecks EligibilityCheck[]

  @@unique([commissionId, discipline, version])
  @@map("rulesets")
}

model RulesetRequirement {
  id                String           @id @default(uuid())
  rulesetId         String           @map("ruleset_id")

  // Requirement Details
  name              String
  description       String?
  documentType      DocumentType     @map("document_type")

  // Rules
  isRequired        Boolean          @default(true) @map("is_required")
  expirationDays    Int?             @map("expiration_days") // How long document is valid

  // Conditional Requirements
  condition         String?          // JSON condition, e.g., {"ageOver": 35}
  conditionDescription String?       @map("condition_description")

  // Order for display
  sortOrder         Int              @default(0) @map("sort_order")

  // Relations
  ruleset           Ruleset          @relation(fields: [rulesetId], references: [id], onDelete: Cascade)

  @@map("ruleset_requirements")
}

model EligibilityCheck {
  id                String           @id @default(uuid())
  fighterId         String           @map("fighter_id")
  rulesetId         String           @map("ruleset_id")

  // Result
  status            EligibilityStatus
  overallScore      Float?           @map("overall_score") // 0-100

  // Override
  isOverridden      Boolean          @default(false) @map("is_overridden")
  overriddenById    String?          @map("overridden_by_id")
  overrideReason    String?          @map("override_reason")
  overriddenAt      DateTime?        @map("overridden_at")

  // Valid period
  validFrom         DateTime         @default(now()) @map("valid_from")
  validUntil        DateTime?        @map("valid_until")

  // Timestamps
  checkedAt         DateTime         @default(now()) @map("checked_at")

  // Relations
  fighter           Fighter          @relation(fields: [fighterId], references: [id], onDelete: Cascade)
  ruleset           Ruleset          @relation(fields: [rulesetId], references: [id])
  overriddenBy      User?            @relation("EligibilityOverrider", fields: [overriddenById], references: [id])
  requirementResults RequirementResult[]

  @@index([fighterId, rulesetId])
  @@map("eligibility_checks")
}

model RequirementResult {
  id                  String           @id @default(uuid())
  eligibilityCheckId  String           @map("eligibility_check_id")
  requirementName     String           @map("requirement_name")
  documentType        DocumentType     @map("document_type")

  // Result
  isFulfilled         Boolean          @map("is_fulfilled")
  isRequired          Boolean          @map("is_required")

  // Document reference
  documentId          String?          @map("document_id")
  documentExpiresAt   DateTime?        @map("document_expires_at")

  // Notes
  notes               String?

  // Relations
  eligibilityCheck    EligibilityCheck @relation(fields: [eligibilityCheckId], references: [id], onDelete: Cascade)

  @@map("requirement_results")
}

// ============================================================================
// Events & Bouts (Supporting Phase 2 Fighter record)
// ============================================================================

enum EventStatus {
  DRAFT
  SUBMITTED
  APPROVED
  REJECTED
  CANCELLED
  COMPLETED
}

enum BoutStatus {
  SCHEDULED
  CANCELLED
  COMPLETED
  NO_CONTEST
}

enum BoutResult {
  WIN_KO
  WIN_TKO
  WIN_SUBMISSION
  WIN_DECISION_UNANIMOUS
  WIN_DECISION_SPLIT
  WIN_DECISION_MAJORITY
  WIN_DQ
  DRAW
  NO_CONTEST
  CANCELLED
}

model Event {
  id                String           @id @default(uuid())
  promotionId       String           @map("promotion_id")
  commissionId      String?          @map("commission_id")

  // Event Details
  name              String
  description       String?
  venue             String?
  city              String?
  state             String?
  country           String?

  // Dates
  eventDate         DateTime         @map("event_date")
  doorsOpen         DateTime?        @map("doors_open")
  weighInDate       DateTime?        @map("weigh_in_date")

  // Status
  status            EventStatus      @default(DRAFT)

  // Approval
  submittedAt       DateTime?        @map("submitted_at")
  approvedAt        DateTime?        @map("approved_at")
  approvedById      String?          @map("approved_by_id")
  rejectionReason   String?          @map("rejection_reason")

  // Timestamps
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  // Relations
  bouts             Bout[]

  @@index([eventDate])
  @@index([status])
  @@map("events")
}

model Bout {
  id                String           @id @default(uuid())
  eventId           String           @map("event_id")

  // Fighters
  fighterAId        String           @map("fighter_a_id")
  fighterBId        String           @map("fighter_b_id")

  // Bout Details
  weightClass       WeightClass      @map("weight_class")
  discipline        Discipline
  rounds            Int              @default(3)
  roundMinutes      Int              @default(5) @map("round_minutes")
  isMainEvent       Boolean          @default(false) @map("is_main_event")
  isCoMain          Boolean          @default(false) @map("is_co_main")
  boutOrder         Int              @default(0) @map("bout_order")

  // Contract signing
  fighterASignedAt  DateTime?        @map("fighter_a_signed_at")
  fighterBSignedAt  DateTime?        @map("fighter_b_signed_at")

  // Status
  status            BoutStatus       @default(SCHEDULED)

  // Result
  winnerId          String?          @map("winner_id")
  result            BoutResult?
  resultRound       Int?             @map("result_round")
  resultTime        String?          @map("result_time") // e.g., "2:34"
  resultNotes       String?          @map("result_notes")

  // Timestamps
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  // Relations
  event             Event            @relation(fields: [eventId], references: [id], onDelete: Cascade)
  fighterA          Fighter          @relation("FighterA", fields: [fighterAId], references: [id])
  fighterB          Fighter          @relation("FighterB", fields: [fighterBId], references: [id])

  @@index([eventId])
  @@map("bouts")
}

// ============================================================================
// AI Processing Queue (Phase 3)
// ============================================================================

enum ProcessingStatus {
  QUEUED
  PROCESSING
  COMPLETED
  FAILED
  RETRYING
}

model DocumentProcessingJob {
  id                String           @id @default(uuid())
  documentId        String           @map("document_id")

  // Status
  status            ProcessingStatus @default(QUEUED)

  // Processing details
  textractJobId     String?          @map("textract_job_id")
  attempts          Int              @default(0)
  maxAttempts       Int              @default(3) @map("max_attempts")
  lastError         String?          @map("last_error")

  // Results
  rawTextractOutput Json?            @map("raw_textract_output")
  classificationResult Json?         @map("classification_result")
  extractionResult  Json?            @map("extraction_result")

  // Timing
  startedAt         DateTime?        @map("started_at")
  completedAt       DateTime?        @map("completed_at")

  // Timestamps
  createdAt         DateTime         @default(now()) @map("created_at")
  updatedAt         DateTime         @updatedAt @map("updated_at")

  @@index([status])
  @@index([documentId])
  @@map("document_processing_jobs")
}

// ============================================================================
// PHASE 5: Event Approval Workflow
// ============================================================================

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
  REVISION_REQUESTED
}

model EventApproval {
  id                String           @id @default(uuid())
  eventId           String           @map("event_id")
  reviewerId        String           @map("reviewer_id")

  // Approval Details
  status            ApprovalStatus   @default(PENDING)
  notes             String?

  // Delegation
  delegatedFromId   String?          @map("delegated_from_id")

  // Timestamps
  submittedAt       DateTime         @default(now()) @map("submitted_at")
  reviewedAt        DateTime?        @map("reviewed_at")

  @@index([eventId])
  @@index([reviewerId])
  @@map("event_approvals")
}

// ============================================================================
// PHASE 6: Notifications
// ============================================================================

enum NotificationType {
  // Document related
  DOCUMENT_EXPIRING
  DOCUMENT_EXPIRED
  DOCUMENT_UPLOADED
  DOCUMENT_APPROVED
  DOCUMENT_REJECTED

  // Event related
  EVENT_SUBMITTED
  EVENT_APPROVED
  EVENT_REJECTED
  EVENT_REMINDER
  BOUT_SIGNED

  // License related
  LICENSE_EXPIRING
  LICENSE_EXPIRED
  LICENSE_APPROVED
  LICENSE_SUSPENDED

  // Suspension related
  SUSPENSION_CREATED
  SUSPENSION_LIFTED

  // Eligibility related
  ELIGIBILITY_CHANGED
  ELIGIBILITY_CHECK_COMPLETED

  // System
  SYSTEM_ANNOUNCEMENT
  WELCOME
}

enum NotificationChannel {
  IN_APP
  EMAIL
  PUSH
  SMS
}

enum NotificationStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
}

model Notification {
  id                String              @id @default(uuid())
  userId            String              @map("user_id")

  // Content
  type              NotificationType
  title             String
  message           String
  data              Json?               // Additional context data

  // Delivery
  channel           NotificationChannel @default(IN_APP)
  status            NotificationStatus  @default(PENDING)

  // Related entity
  entityType        String?             @map("entity_type")
  entityId          String?             @map("entity_id")

  // Tracking
  sentAt            DateTime?           @map("sent_at")
  deliveredAt       DateTime?           @map("delivered_at")
  readAt            DateTime?           @map("read_at")
  failureReason     String?             @map("failure_reason")

  // Timestamps
  createdAt         DateTime            @default(now()) @map("created_at")

  @@index([userId, status])
  @@index([userId, createdAt])
  @@index([type])
  @@map("notifications")
}

model NotificationPreference {
  id                String              @id @default(uuid())
  userId            String              @map("user_id")

  // Preference settings
  type              NotificationType
  inAppEnabled      Boolean             @default(true) @map("in_app_enabled")
  emailEnabled      Boolean             @default(true) @map("email_enabled")
  pushEnabled       Boolean             @default(false) @map("push_enabled")
  smsEnabled        Boolean             @default(false) @map("sms_enabled")

  // Timestamps
  updatedAt         DateTime            @updatedAt @map("updated_at")

  @@unique([userId, type])
  @@map("notification_preferences")
}

// ============================================================================
// PHASE 6: Compliance Reports
// ============================================================================

enum ReportType {
  FIGHTER_COMPLIANCE
  EVENT_SUMMARY
  SUSPENSION_REPORT
  LICENSE_EXPIRATION
  DOCUMENT_AUDIT
  FINANCIAL_SUMMARY
  COMMISSION_ACTIVITY
}

enum ReportStatus {
  PENDING
  GENERATING
  COMPLETED
  FAILED
}

enum ReportFormat {
  PDF
  CSV
  EXCEL
  JSON
}

model Report {
  id                String           @id @default(uuid())
  requestedById     String           @map("requested_by_id")
  commissionId      String?          @map("commission_id")

  // Report Details
  type              ReportType
  name              String
  description       String?
  format            ReportFormat     @default(PDF)

  // Parameters
  parameters        Json?            // Filter criteria, date ranges, etc.

  // Status
  status            ReportStatus     @default(PENDING)

  // Output
  fileKey           String?          @map("file_key") // S3 key for generated report
  fileSize          Int?             @map("file_size")
  errorMessage      String?          @map("error_message")

  // Scheduling
  isScheduled       Boolean          @default(false) @map("is_scheduled")
  scheduleConfig    Json?            @map("schedule_config") // Cron expression, etc.
  lastRunAt         DateTime?        @map("last_run_at")
  nextRunAt         DateTime?        @map("next_run_at")

  // Timestamps
  startedAt         DateTime?        @map("started_at")
  completedAt       DateTime?        @map("completed_at")
  createdAt         DateTime         @default(now()) @map("created_at")

  @@index([type, status])
  @@index([requestedById])
  @@index([commissionId])
  @@map("reports")
}

// ============================================================================
// PHASE 6: Commission Dashboard Analytics
// ============================================================================

model AnalyticsSnapshot {
  id                String           @id @default(uuid())
  commissionId      String?          @map("commission_id")

  // Snapshot period
  periodType        String           @map("period_type") // 'daily', 'weekly', 'monthly'
  periodStart       DateTime         @map("period_start")
  periodEnd         DateTime         @map("period_end")

  // Fighter metrics
  totalFighters           Int        @default(0) @map("total_fighters")
  activeFighters          Int        @default(0) @map("active_fighters")
  newFighters             Int        @default(0) @map("new_fighters")
  eligibleFighters        Int        @default(0) @map("eligible_fighters")
  suspendedFighters       Int        @default(0) @map("suspended_fighters")

  // Document metrics
  totalDocuments          Int        @default(0) @map("total_documents")
  pendingDocuments        Int        @default(0) @map("pending_documents")
  approvedDocuments       Int        @default(0) @map("approved_documents")
  rejectedDocuments       Int        @default(0) @map("rejected_documents")
  expiringDocuments       Int        @default(0) @map("expiring_documents")

  // Event metrics
  totalEvents             Int        @default(0) @map("total_events")
  pendingEvents           Int        @default(0) @map("pending_events")
  approvedEvents          Int        @default(0) @map("approved_events")
  completedEvents         Int        @default(0) @map("completed_events")

  // License metrics
  totalLicenses           Int        @default(0) @map("total_licenses")
  activeLicenses          Int        @default(0) @map("active_licenses")
  expiringLicenses        Int        @default(0) @map("expiring_licenses")

  // Additional metrics stored as JSON for flexibility
  additionalMetrics       Json?      @map("additional_metrics")

  // Timestamps
  createdAt               DateTime   @default(now()) @map("created_at")

  @@unique([commissionId, periodType, periodStart])
  @@index([periodStart])
  @@map("analytics_snapshots")
}

// ============================================================================
// INDEXES - Add as needed for query optimization
// ============================================================================
